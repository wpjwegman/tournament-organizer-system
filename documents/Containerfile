# Tournament Organizer Documentation - Podman Container
# Professional Podman-based development environment

FROM python:3.13-slim as base

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js for markdownlint-cli2
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs

# Install markdownlint-cli2 globally
RUN npm install -g markdownlint-cli2

# Install uv
RUN pip install uv

# Create non-root user
RUN useradd --create-home --shell /bin/bash tournament
# Ensure permissions for Python interpreter and uv managed installations
RUN chmod -R a+rx /home/tournament/.local || true
USER tournament
# Set working directory to project documents for pre-commit
WORKDIR /workspace/documents

# Development stage
FROM base as development

# Copy dependency files
COPY --chown=tournament:tournament pyproject.toml uv.lock ./

# Install dependencies with uv
RUN uv sync --frozen

# Default command
CMD ["pwsh"]
